# AC Inventory - Inventory & Finance Dashboard

AC Inventory is a comprehensive dashboard for small electronics businesses to track inventory, manage finances, and analyze supplier data in real-time. It provides key performance indicators, stock management tools, and financial reporting in a clean, responsive interface, powered by Google's Gemini AI for mock data generation.

This document provides the necessary specifications to set up the Google Cloud Firestore database that will serve as the backend for the application.

## Table of Contents
1.  [Firebase Project Setup](#1-firebase-project-setup)
2.  [Firestore Database Structure](#2-firestore-database-structure)
    - [Collections Overview](#collections-overview)
    - [Detailed Collection Schemas](#detailed-collection-schemas)
        - [`staff`](#collection-staff)
        - [`suppliers`](#collection-suppliers)
        - [`accounts`](#collection-accounts)
        - [`transactions`](#collection-transactions)
        - [`locations`](#collection-locations)
        - [`components`](#collection-components)
        - [`movements`](#collection-movements)
        - [`sales`](#collection-sales)
        - [`purchaseOrders`](#collection-purchaseorders)
3.  [Firestore Security Rules](#3-firestore-security-rules)

---

## 1. Firebase Project Setup

1.  **Create a Firebase Project:** Go to the [Firebase Console](https://console.firebase.google.com/) and create a new project.
2.  **Create a Web App:** Within your project, create a new Web App. Firebase will provide you with a configuration object.
3.  **Update Configuration:** Copy the `firebaseConfig` object and paste it into the `firebase/config.ts` file in this project.
4.  **Enable Firestore:** In the Firebase Console, go to the "Firestore Database" section and create a new database. Start in **test mode** for initial setup, but be sure to apply the security rules below before going to production.

---

## 2. Firestore Database Structure

### Collections Overview

Your Firestore database should have the following top-level collections. Document IDs can be auto-generated by Firestore unless a specific ID is suggested in the initial data.

-   `staff`
-   `suppliers`
-   `accounts`
-   `transactions`
-   `locations`
-   `components`
-   `movements`
-   `sales`
-   `purchaseOrders`

### Detailed Collection Schemas

This section details the required document structure for each collection. You can use the data from the `data/initialData.ts` file to seed your database for development and testing.

#### Collection: `staff`
Stores information about all employees. This collection is crucial for authentication and role-based access.

| Field | Type | Description | Example |
| :--- | :--- | :--- | :--- |
| `name` | `string` | Full name of the staff member. | "Alice (Warehouse)" |
| `role` | `string` | Must be 'Admin', 'Warehouse Staff', or 'Sales Rep'. | "Warehouse Staff" |
| `email` | `string` | Contact email. | "alice@acunova.com" |
| `phone` | `string` | Contact phone number. | "123-456-7891" |
| `status`| `string` | Must be 'active', 'on_leave', or 'terminated'. | "active" |

**Initial Data:** Use the `initialStaff` array from `data/initialData.ts`. It's recommended to use the provided IDs (e.g., `admin_user`, `staff_1`) as the document IDs.

---
#### Collection: `suppliers`
Stores information about component suppliers.

| Field | Type | Description | Example |
| :--- | :--- | :--- | :--- |
| `name` | `string` | The supplier's company name. | "ComponentSource Inc." |
| `contactName` | `string` | Primary contact person's name. | "Jane Doe" |
| `contactEmail`| `string` | Primary contact person's email. | "jane.d@csource.com" |
| `status` | `string` | 'active' or 'inactive'. | "active" |
| `totalSpend` | `number` | The total amount spent with this supplier. | 12500 |
| `lastPurchaseDate` | `timestamp` | The date of the last purchase order. | `Timestamp(seconds=..., nanoseconds=...)` |

**Initial Data:** Use the `initialSuppliers` array from `data/initialData.ts`.

---
#### Collection: `accounts`
Stores financial accounts like bank accounts and cash on hand.

| Field | Type | Description | Example |
| :--- | :--- | :--- | :--- |
| `name` | `string` | The account name. | "Main Checking Account" |
| `type` | `string` | 'checking', 'savings', or 'cash'. | "checking" |
| `balance` | `number` | The current balance of the account. | 52300 |

**Initial Data:** Use `initialAccounts`. Additionally, create a `cash` account for each staff member with a starting balance of `0`. The document ID for these should follow the pattern `${staffId}_cash` (e.g., `staff_1_cash`).

---
#### Collection: `transactions`
A ledger of all financial movements.

| Field | Type | Description | Example |
| :--- | :--- | :--- | :--- |
| `type` | `string` | 'deposit', 'withdrawal', 'transfer', 'expense', 'revenue'. | "deposit" |
| `description` | `string` | A brief summary of the transaction. | "Client Payment - Project X" |
| `amount` | `number` | The transaction amount. | 5000 |
| `date` | `timestamp` | The date the transaction occurred. | `Timestamp(...)` |
| `fromAccountId` | `string` | (Optional) Document ID from the `accounts` collection. | "acc_main_check" |
| `toAccountId` | `string` | (Optional) Document ID from the `accounts` collection. | "acc_main_check" |
| `category` | `string` | (Optional) A category for the transaction. | "Sales" |

**Initial Data:** Use the `initialTransactions` array.

---
#### Collection: `locations`
Stores physical or virtual stock locations.

| Field | Type | Description | Example |
| :--- | :--- | :--- | :--- |
| `locationId` | `string` | **Use this as the Document ID.** | "loc_main_wh" |
| `locationName`| `string` | The user-friendly name of the location. | "Main Warehouse" |

**Initial Data:** Use `initialLocations`. Additionally, create a personal stock location for each staff member. The document ID should follow the pattern `${staffId}_stock` (e.g., `staff_1_stock`).

---
#### Collection: `components`
The master list of all inventory items.

| Field | Type | Description | Example |
| :--- | :--- | :--- | :--- |
| `name` | `string` | The component's name. | "ATmega328P Microcontroller"|
| `description` | `string` | A brief description. | "8-bit AVR MCU" |
| `category` | `string` | A category for grouping. | "Microcontrollers" |
| `unit` | `string` | 'pcs', 'reel', 'kit', or 'm'. | "pcs" |
| `default_price` | `number` | The default purchase price per unit. | 2.5 |
| `reorder_level`| `number` | The stock level at which a reorder is needed. | 50 |
| `current_stock` | `number` | The total quantity across all locations. | 75 |
| `stock_breakdown` | `array` | An array of maps detailing stock per location. | `[{ locationId: "...", locationName: "...", quantity: 65 }]` |

**Initial Data:** Use the `initialComponents` array.

---
#### Collection: `movements`
An audit trail of every time a stock item's quantity changes.

| Field | Type | Description | Example |
| :--- | :--- | :--- | :--- |
| `type` | `string` | 'purchase', 'sale', 'transfer', 'adjustment'. | "purchase" |
| `componentName`| `string` | Denormalized name for easy display. | "ESP32-WROOM-32" |
| `fromLocationName`|`string` | (Optional) Source location name. | "Shop Floor" |
| `toLocationName`| `string` | (Optional) Destination location name. | "Main Warehouse" |
| `qty` | `number` | The quantity of items moved. | 100 |
| `unit_price`| `number` | The price per unit for this movement. | 3.5 |
| `total_price`| `number` | `qty` * `unit_price`. | 350 |
| `timestamp` | `timestamp` | The exact time of the movement. | `Timestamp(...)` |
| `createdBy` | `string` | The name of the staff member who initiated it. | "Alice" |
| `reason` | `string` | (Optional) Reason, especially for adjustments. | "Cycle count correction" |

**Initial Data:** This collection starts empty.

---
#### Collection: `sales`
A record of all sales made to customers.

| Field | Type | Description | Example |
| :--- | :--- | :--- | :--- |
| `staffId` | `string` | Document ID of the staff member who made the sale. | "staff_2" |
| `staffName` | `string` | Denormalized name of the staff member. | "Bob (Sales)" |
| `customerName`| `string` | Name of the customer. | "John Doe" |
| `totalAmount` | `number` | The total value of the sale. | 40.00 |
| `date` | `timestamp` | The date of the sale. | `Timestamp(...)` |
| `paymentToAccountId`| `string` | Document ID of the account receiving payment. | "staff_2_cash" |
| `fromLocationId`| `string` | Document ID of the location where stock was taken from. | "loc_shop_fl" |
| `items` | `array` | An array of maps, where each map is a `SaleItem`. | `[{ componentId: "...", quantity: 10, ... }]` |

**Initial Data:** This collection starts empty.

---
#### Collection: `purchaseOrders`
Tracks all purchase orders from suppliers for both clients and internal stock.

| Field | Type | Description |
| :--- | :--- | :--- |
| `supplierId` | `string` | Document ID of the supplier. |
| `supplierName`| `string` | Denormalized name of the supplier. |
| `isPersonalStockOrder`|`boolean` | `true` if for internal stock, `false` if for clients. |
| `status` | `string` | 'draft', 'placed', or 'received'. |
| `datePlaced` | `timestamp` | (Optional) The date the order was placed. |
| `dateReceived`| `timestamp` | (Optional) The date the order was received. |
| `receivingStaffId`| `string` | Document ID of the staff member assigned to receive it. |
| `receivingStaffName`|`string` | Denormalized name of the receiving staff member. |
| `notes` | `string` | (Optional) General notes about the PO. |
| `receiptNotes`| `string` | (Optional) Notes added upon receipt. |
| `totalCost` | `number` | The total cost of all items in the PO. |
| `personalStockItems`| `array` | (If `isPersonalStockOrder` is true) An array of `OrderItem` maps. |
| `clientOrders`| `array` | (If `isPersonalStockOrder` is false) An array of `ClientOrder` maps. |

**`OrderItem` Map Structure:**
`{ componentId, componentName, quantity, purchasePrice, salePrice }`

**`ClientOrder` Map Structure:**
`{ id, clientName, totalCost, totalValue, items: [array of OrderItem maps] }`

**Initial Data:** This collection starts empty.

---

## 3. Firestore Security Rules

These rules enforce the role-based access control implemented in the application. **Important:** These rules assume you are using **Firebase Authentication** and that each authenticated user's `uid` matches their corresponding document ID in the `staff` collection.

```javascript
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to get the role of the currently signed-in user.
    function getUserRole() {
      return get(/databases/$(database)/documents/staff/$(request.auth.uid)).data.role;
    }

    // Admins can do anything.
    match /{document=**} {
      allow read, write: if getUserRole() == 'Admin';
    }

    // --- Warehouse Staff Rules ---
    function isWarehouseStaff() {
      return getUserRole() == 'Warehouse Staff';
    }

    match /components/{docId} {
      allow read, write: if isWarehouseStaff();
    }
    match /locations/{docId} {
      allow read, write: if isWarehouseStaff();
    }
    match /movements/{docId} {
      allow read, write: if isWarehouseStaff();
    }
    match /suppliers/{docId} {
      allow read, write: if isWarehouseStaff();
    }
    match /purchaseOrders/{docId} {
      allow read, write: if isWarehouseStaff();
    }
    match /staff/{docId} {
      // Allow reading staff list for assignments.
      allow get: if isWarehouseStaff();
    }

    // --- Sales Rep Rules ---
    function isSalesRep() {
      return getUserRole() == 'Sales Rep';
    }

    match /sales/{docId} {
      // Allow reading all sales, but only creating/updating their own.
      allow read: if isSalesRep();
      allow create, update: if isSalesRep() && request.resource.data.staffId == request.auth.uid;
    }
    
    // Sales Reps need to read components and locations to make sales.
    match /components/{docId} {
        allow get, list: if isSalesRep();
    }
    match /locations/{docId} {
        allow get, list: if isSalesRep();
    }
    
    // All staff should be able to read their own staff document and associated accounts
    match /staff/{staffId} {
      allow get: if request.auth.uid == staffId;
    }
    match /accounts/{accountId} {
      // Account ID for staff is formatted as '{staffId}_cash'
      allow get, list: if request.auth.uid != null && accountId.startsWith(request.auth.uid);
    }
  }
}
```